# Perplexica AI Search Service with SearXNG

services:
  perplexica:
    image: itzcrazykns1337/perplexica:main
    container_name: co-perplexica-service
    restart: unless-stopped
    environment:
      - SEARXNG_API_URL=http://searxng:8080
      - DATA_DIR=/home/perplexica
    volumes:
      - perplexica-data:/home/perplexica/data
      - perplexica-uploads:/home/perplexica/uploads
      - ./configs/perplexica.toml:/home/perplexica/config.toml:ro
    networks:
      - app-network
    labels:
      glance.name: "Perplexica"
      glance.icon: "si:perplexity"
      glance.url: "https://perplexica.${PRIMARY_DOMAIN}"
      glance.category: "search"
      glance.description: "AI-powered search engine"
    depends_on:
      - searxng
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  searxng:
    image: docker.io/searxng/searxng:latest
    container_name: co-perplexica-searxng
    restart: unless-stopped
    volumes:
      - ./configs/searxng:/etc/searxng:rw
    networks:
      - app-network
    labels:
      glance.name: "SearXNG"
      glance.icon: "si:searxng"
      glance.category: "search"
      glance.description: "Privacy-focused metasearch engine"
    environment:
      - SEARXNG_BASE_URL=http://searxng:8080/
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:8080/healthz"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

volumes:
  perplexica-data:
    name: ${COMPOSE_PROJECT_NAME}_perplexica-data
  perplexica-uploads:
    name: ${COMPOSE_PROJECT_NAME}_perplexica-uploads

networks:
  app-network:
    name: ${COMPOSE_PROJECT_NAME}_app-network